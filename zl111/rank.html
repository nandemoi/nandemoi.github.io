<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>進階程式設計</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        .container { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 20px; }
        .card { border: 1px solid #ddd; border-radius: 8px; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card h3 { margin: 0 0 10px 0; color: #333; }
        .card p { margin: 5px 0; }
        .label { font-weight: bold; color: #666; }
        .empty-card { display: none; align-items: center; justify-content: center; font-size: 48px; }
        img { max-width: 100%; height: auto; margin-top: 20px; }
        #shuffle-btn {
            width: 100px;
            min-width: 100px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>同學參考一下，把握時間多練習～～～</h1>
    <p>2025-10-01 你的努力： <button id="shuffle-btn">亂序排列</button></p>
    <div class="container">

<div class="card" style="background-color: hsl(278, 30%, 90%);">
        <h3 data-real-name="20516杜克煦">◯◯煦</h3>
            <p><span class="label">ＡＣΔ：</span>6</p>
            <p><span class="label">耗時Δ：</span>117363</p>
            <p><span class="label">分數Δ：</span>3.6</p>
        </div>

<div class="card" style="background-color: hsl(46, 30%, 90%);">
        <h3 data-real-name="20627黃紹宸">◯紹◯</h3>
            <p><span class="label">ＡＣΔ：</span>6</p>
            <p><span class="label">耗時Δ：</span>100741</p>
            <p><span class="label">分數Δ：</span>3.0</p>
        </div>

<div class="card" style="background-color: hsl(220, 30%, 90%);">
        <h3 data-real-name="20514吳昱衡">◯◯衡</h3>
            <p><span class="label">ＡＣΔ：</span>4</p>
            <p><span class="label">耗時Δ：</span>67119</p>
            <p><span class="label">分數Δ：</span>2.0</p>
        </div>

<div class="card" style="background-color: hsl(348, 30%, 90%);">
        <h3 data-real-name="20622陳宏羽">◯宏◯</h3>
            <p><span class="label">ＡＣΔ：</span>6</p>
            <p><span class="label">耗時Δ：</span>100651</p>
            <p><span class="label">分數Δ：</span>3.0</p>
        </div>

<div class="card" style="background-color: hsl(69, 30%, 90%);">
        <h3 data-real-name="20426陳澤鑫">◯◯鑫</h3>
            <p><span class="label">ＡＣΔ：</span>8</p>
            <p><span class="label">耗時Δ：</span>200976</p>
            <p><span class="label">分數Δ：</span>6.0</p>
        </div>

<div class="card" style="background-color: hsl(162, 30%, 90%);">
        <h3 data-real-name="20402林怡萱">◯怡◯</h3>
            <p><span class="label">ＡＣΔ：</span>3</p>
            <p><span class="label">耗時Δ：</span>75533</p>
            <p><span class="label">分數Δ：</span>2.0</p>
        </div>

<div class="card" style="background-color: hsl(243, 30%, 90%);">
        <h3 data-real-name="20630蔡兆飛">◯兆◯</h3>
            <p><span class="label">ＡＣΔ：</span>0</p>
            <p><span class="label">耗時Δ：</span>0</p>
            <p><span class="label">分數Δ：</span>0.0</p>
        </div>

<div class="card" style="background-color: hsl(174, 30%, 90%);">
        <h3 data-real-name="20422林囷橙">◯囷◯</h3>
            <p><span class="label">ＡＣΔ：</span>8</p>
            <p><span class="label">耗時Δ：</span>167683</p>
            <p><span class="label">分數Δ：</span>5.0</p>
        </div>

<div class="card" style="background-color: hsl(209, 30%, 90%);">
        <h3 data-real-name="20722許紘碩">◯紘◯</h3>
            <p><span class="label">ＡＣΔ：</span>0</p>
            <p><span class="label">耗時Δ：</span>0</p>
            <p><span class="label">分數Δ：</span>0.9</p>
        </div>

<div class="card" style="background-color: hsl(11, 30%, 90%);">
        <h3 data-real-name="20512劉安婕">◯安◯</h3>
            <p><span class="label">ＡＣΔ：</span>9</p>
            <p><span class="label">耗時Δ：</span>217876</p>
            <p><span class="label">分數Δ：</span>5.6</p>
        </div>

<div class="card" style="background-color: hsl(313, 30%, 90%);">
        <h3 data-real-name="20713吳宥廷">◯◯廷</h3>
            <p><span class="label">ＡＣΔ：</span>8</p>
            <p><span class="label">耗時Δ：</span>184612</p>
            <p><span class="label">分數Δ：</span>5.0</p>
        </div>

<div class="card" style="background-color: hsl(116, 30%, 90%);">
        <h3 data-real-name="20604李亮宣">◯亮◯</h3>
            <p><span class="label">ＡＣΔ：</span>1</p>
            <p><span class="label">耗時Δ：</span>41941</p>
            <p><span class="label">分數Δ：</span>1.6</p>
        </div>

<div class="card" style="background-color: hsl(81, 30%, 90%);">
        <h3 data-real-name="20425陳柏宇">◯◯宇</h3>
            <p><span class="label">ＡＣΔ：</span>1</p>
            <p><span class="label">耗時Δ：</span>28434</p>
            <p><span class="label">分數Δ：</span>1.0</p>
        </div>

<div class="card" style="background-color: hsl(23, 30%, 90%);">
        <h3 data-real-name="20525黃少杰">◯◯杰</h3>
            <p><span class="label">ＡＣΔ：</span>13</p>
            <p><span class="label">耗時Δ：</span>334976</p>
            <p><span class="label">分數Δ：</span>10.0</p>
        </div>

<div class="card" style="background-color: hsl(127, 30%, 90%);">
        <h3 data-real-name="20728葉承穎">◯◯穎</h3>
            <p><span class="label">ＡＣΔ：</span>4</p>
            <p><span class="label">耗時Δ：</span>67127</p>
            <p><span class="label">分數Δ：</span>2.0</p>
        </div>

<div class="card" style="background-color: hsl(301, 30%, 91%);">
        <h3 data-real-name="20617官威佑">◯威◯</h3>
            <p><span class="label">ＡＣΔ：</span>12</p>
            <p><span class="label">耗時Δ：</span>226592</p>
            <p><span class="label">分數Δ：</span>6.5</p>
        </div>

<div class="card" style="background-color: hsl(185, 30%, 91%);">
        <h3 data-real-name="20429黃子齊">◯◯齊</h3>
            <p><span class="label">ＡＣΔ：</span>0</p>
            <p><span class="label">耗時Δ：</span>0</p>
            <p><span class="label">分數Δ：</span>0.0</p>
        </div>

<div class="card" style="background-color: hsl(336, 30%, 91%);">
        <h3 data-real-name="20521馬澄緯">◯澄◯</h3>
            <p><span class="label">ＡＣΔ：</span>7</p>
            <p><span class="label">耗時Δ：</span>234367</p>
            <p><span class="label">分數Δ：</span>7.0</p>
        </div>

<div class="card" style="background-color: hsl(255, 30%, 91%);">
        <h3 data-real-name="20714林存鈞">◯存◯</h3>
            <p><span class="label">ＡＣΔ：</span>4</p>
            <p><span class="label">耗時Δ：</span>133300</p>
            <p><span class="label">分數Δ：</span>4.0</p>
        </div>

<div class="card" style="background-color: hsl(197, 30%, 91%);">
        <h3 data-real-name="20408彭奕寧">◯◯寧</h3>
            <p><span class="label">ＡＣΔ：</span>1</p>
            <p><span class="label">耗時Δ：</span>41925</p>
            <p><span class="label">分數Δ：</span>1.0</p>
        </div>

<div class="card" style="background-color: hsl(92, 30%, 91%);">
        <h3 data-real-name="20601田頤臻">◯◯臻</h3>
            <p><span class="label">ＡＣΔ：</span>3</p>
            <p><span class="label">耗時Δ：</span>75585</p>
            <p><span class="label">分數Δ：</span>2.0</p>
        </div>

<div class="card" style="background-color: hsl(290, 30%, 91%);">
        <h3 data-real-name="20432詹斐元">◯斐◯</h3>
            <p><span class="label">ＡＣΔ：</span>6</p>
            <p><span class="label">耗時Δ：</span>200959</p>
            <p><span class="label">分數Δ：</span>6.0</p>
        </div>

<div class="card" style="background-color: hsl(58, 30%, 91%);">
        <h3 data-real-name="20531劉以昇">◯◯昇</h3>
            <p><span class="label">ＡＣΔ：</span>6</p>
            <p><span class="label">耗時Δ：</span>226513</p>
            <p><span class="label">分數Δ：</span>5.5</p>
        </div>

<div class="card" style="background-color: hsl(267, 30%, 91%);">
        <h3 data-real-name="20520孫可洺">◯◯洺</h3>
            <p><span class="label">ＡＣΔ：</span>12</p>
            <p><span class="label">耗時Δ：</span>201419</p>
            <p><span class="label">分數Δ：</span>6.0</p>
        </div>

<div class="card" style="background-color: hsl(139, 30%, 91%);">
        <h3 data-real-name="20528黃靖傑">◯靖◯</h3>
            <p><span class="label">ＡＣΔ：</span>3</p>
            <p><span class="label">耗時Δ：</span>108262</p>
            <p><span class="label">分數Δ：</span>3.0</p>
        </div>

<div class="card" style="background-color: hsl(325, 30%, 91%);">
        <h3 data-real-name="20607張嘉容">◯◯容</h3>
            <p><span class="label">ＡＣΔ：</span>16</p>
            <p><span class="label">耗時Δ：</span>318569</p>
            <p><span class="label">分數Δ：</span>9.5</p>
        </div>

<div class="card" style="background-color: hsl(0, 30%, 91%);">
        <h3 data-real-name="20614吳孟澤">◯◯澤</h3>
            <p><span class="label">ＡＣΔ：</span>2</p>
            <p><span class="label">耗時Δ：</span>75426</p>
            <p><span class="label">分數Δ：</span>2.0</p>
        </div>

<div class="card" style="background-color: hsl(104, 30%, 91%);">
        <h3 data-real-name="20712王茗禾">◯◯禾</h3>
            <p><span class="label">ＡＣΔ：</span>1</p>
            <p><span class="label">耗時Δ：</span>33005</p>
            <p><span class="label">分數Δ：</span>1.0</p>
        </div>

<div class="card" style="background-color: hsl(150, 30%, 91%);">
        <h3 data-real-name="20503季宥辰">◯◯辰</h3>
            <p><span class="label">ＡＣΔ：</span>1</p>
            <p><span class="label">耗時Δ：</span>33466</p>
            <p><span class="label">分數Δ：</span>1.0</p>
        </div>

<div class="card" style="background-color: hsl(34, 30%, 91%);">
        <h3 data-real-name="20603李尚玲">◯尚◯</h3>
            <p><span class="label">ＡＣΔ：</span>16</p>
            <p><span class="label">耗時Δ：</span>318673</p>
            <p><span class="label">分數Δ：</span>9.5</p>
        </div>

<div class="card" style="background-color: hsl(232, 30%, 92%);">
        <h3 data-real-name="20719邱富軒">◯富◯</h3>
            <p><span class="label">ＡＣΔ：</span>8</p>
            <p><span class="label">耗時Δ：</span>136250</p>
            <p><span class="label">分數Δ：</span>8.0</p>
        </div>


        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

        <div class="empty-card card">
            ❓
        </div>

    </div>
<p>統計：</p>
<img src="media/ranksum.png" alt="Ranking Summary Histogram">
    <script>
    const emojis = ["⚽️", "🏐", "📎", "🧭", "🐼", "🎲"];

    function getEmptyPositions(cols, numEmpties, total) {
        const rows = total / cols;
        const positions = [];
        for (let y = 0; y < rows; y++) {
            for (let x = 0; x < cols; x++) {
                positions.push({x, y});
            }
        }
        const emptyPositions = [];
        let available = [...positions];
        const filterEdges = (candidates) => {
            return candidates.filter(pos => {
                if (pos.x === 0 && pos.y === 0) {
                    return Math.random() > 0.9;
                } else {
                    return true;
                }
            });
        };
        if (numEmpties > 0) {
            let filteredAvailable = filterEdges(available);
            if (filteredAvailable.length === 0) {
                filteredAvailable = available;
            }
            const randomIndex = Math.floor(Math.random() * filteredAvailable.length);
            const selectedPos = filteredAvailable[randomIndex];
            emptyPositions.push(selectedPos);
            available.splice(available.indexOf(selectedPos), 1);
        }
        for (let i = 1; i < numEmpties; i++) {
            let candidates = filterEdges(available);
            if (candidates.length === 0) {
                candidates = available;
            }
            let minShared = Infinity;
            for (let pos of candidates) {
                let shared = 0;
                for (let epos of emptyPositions) {
                    if (pos.x === epos.x || pos.y === epos.y) {
                        shared++;
                    }
                }
                if (shared < minShared) {
                    minShared = shared;
                }
            }
            const bestCandidates = candidates.filter(pos => {
                let shared = 0;
                for (let epos of emptyPositions) {
                    if (pos.x === epos.x || pos.y === epos.y) {
                        shared++;
                    }
                }
                return shared === minShared;
            });
            const randomIndex = Math.floor(Math.random() * bestCandidates.length);
            const selectedPos = bestCandidates[randomIndex];
            emptyPositions.push(selectedPos);
            available.splice(available.indexOf(selectedPos), 1);
        }
        return {emptyPositions, available};
    }

    function updateEmpties(layout, mptPos) {
        for (let i = mptPos.available.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [mptPos.available[i], mptPos.available[j]] = [mptPos.available[j], mptPos.available[i]];
        }
        const positions = [];
        for (let y = 0; y < layout.total / layout.cols; y++) {
            for (let x = 0; x < layout.cols; x++) {
                positions.push({x, y});
            }
        }
        let studentIndex = 0;
        let emptyIndex = 0;
        const newOrder = [];
        for (let pos of positions) {
            const isEmpty = mptPos.emptyPositions.some(e => e.x === pos.x && e.y === pos.y);
            if (isEmpty) {
                newOrder.push(layout.emptyCards[emptyIndex++]);
            } else {
                newOrder.push(layout.studentCards[studentIndex++]);
            }
        }
        for (let i = emptyIndex; i < layout.emptyCards.length; i++) {
            newOrder.push(layout.emptyCards[i]);
        }
        layout.container.innerHTML = '';
        newOrder.forEach(card => layout.container.appendChild(card));
        layout.emptyCards.forEach((card, i) => {
            card.style.display = i < layout.numEmptiesNeeded ? 'flex' : 'none';
        });
        const visibleEmptyCards = layout.emptyCards.filter(c => c.style.display === 'flex');
        if (visibleEmptyCards.length > 0) {
            const shuffledEmojis = [...emojis];
            for (let i = shuffledEmojis.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledEmojis[i], shuffledEmojis[j]] = [shuffledEmojis[j], shuffledEmojis[i]];
            }
            visibleEmptyCards.forEach((card, i) => {
                card.innerHTML = shuffledEmojis[i];
            });
            const studentColors = layout.studentCards.map(card => card.style.backgroundColor);
            visibleEmptyCards.forEach(card => {
                const randomColor = studentColors[Math.floor(Math.random() * studentColors.length)];
                card.style.backgroundColor = randomColor;
            });
        }
    }

    function shuffleAndColor(layout, mptPos) {
        for (let i = layout.studentCards.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [layout.studentCards[i], layout.studentCards[j]] = [layout.studentCards[j], layout.studentCards[i]];
        }
        for (let i = mptPos.available.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [mptPos.available[i], mptPos.available[j]] = [mptPos.available[j], mptPos.available[i]];
        }
        const positions = [];
        for (let y = 0; y < layout.total / layout.cols; y++) {
            for (let x = 0; x < layout.cols; x++) {
                positions.push({x, y});
            }
        }
        let studentIndex = 0;
        let emptyIndex = 0;
        const newOrder = [];
        for (let pos of positions) {
            const isEmpty = mptPos.emptyPositions.some(e => e.x === pos.x && e.y === pos.y);
            if (isEmpty) {
                newOrder.push(layout.emptyCards[emptyIndex++]);
            } else {
                newOrder.push(layout.studentCards[studentIndex++]);
            }
        }
        for (let i = emptyIndex; i < layout.emptyCards.length; i++) {
            newOrder.push(layout.emptyCards[i]);
        }
        layout.container.innerHTML = '';
        newOrder.forEach(card => layout.container.appendChild(card));
        layout.emptyCards.forEach((card, i) => {
            card.style.display = i < layout.numEmptiesNeeded ? 'flex' : 'none';
        });
        const visibleEmptyCards = layout.emptyCards.filter(c => c.style.display === 'flex');
        if (visibleEmptyCards.length > 0) {
            const shuffledEmojis = [...emojis];
            for (let i = shuffledEmojis.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledEmojis[i], shuffledEmojis[j]] = [shuffledEmojis[j], shuffledEmojis[i]];
            }
            visibleEmptyCards.forEach((card, i) => {
                card.innerHTML = shuffledEmojis[i];
            });
        }
        const hues = [];
        for (let i = 0; i < layout.numStudents; i++) {
            hues.push((i * 360) / layout.numStudents);
        }
        for (let i = hues.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [hues[i], hues[j]] = [hues[j], hues[i]];
        }
        let hueIndex = 0;
        layout.studentCards.forEach(card => {
            const lightness = 90 + (hueIndex * 2) / (layout.numStudents - 1);
            card.style.backgroundColor = `hsl(${hues[hueIndex]}, 30%, ${lightness}%)`;
            hueIndex++;
        });
    }

    function animateShuffle() {
        const btn = document.getElementById('shuffle-btn');
        btn.disabled = true;
        let steps = 28;
        btn.textContent = `${steps}`;
        let delay = 1;
        let d2 = 1;
        const layout = getLayout();
        function doStep() {
            shuffleAndColor(layout, getEmptyPositions(layout.cols, layout.numEmptiesNeeded, layout.total));
            steps--;
            if (steps <= 0) {
                btn.disabled = false;
                btn.textContent = '亂序排列';
            } else {
                btn.textContent = `${steps}`;
                delay += d2;
                d2 *= 1.2;
                setTimeout(doStep, delay);
            }
        }
        doStep();
    }

    function getLayout() {
        const container = document.querySelector('.container');
        const allCards = Array.from(container.children);
        const studentCards = allCards.filter(c => !c.classList.contains('empty-card'));
        const numStudents = studentCards.length;
        const cols = Math.max(1, Math.floor((container.offsetWidth + 10) / 160));
        const remainder = numStudents % cols;
        const numEmptiesNeeded = remainder === 0 ? 0 : cols - remainder;
        const emptyCards = allCards.filter(c => c.classList.contains('empty-card'));
        const total = numStudents + numEmptiesNeeded;
        return {container, allCards, studentCards, numStudents, cols, remainder, numEmptiesNeeded, emptyCards, total};
    }

    function evtListenPortal(bDoSAC) {
        const layout = getLayout();
        const mptPos = getEmptyPositions(layout.cols, layout.numEmptiesNeeded, layout.total);
        if (bDoSAC) {
            shuffleAndColor(layout, mptPos);
        }
        updateEmpties(layout, mptPos);
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Check for show_names query parameter
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('shownames') && urlParams.get('shownames').toLowerCase() === '1') {
            document.querySelectorAll('.card').forEach(card => {
                const h3 = card.querySelector('h3');
                if (h3) {
                    const realName = h3.getAttribute('data-real-name');
                    if (realName) {
                        const clid = realName.slice(0, 5);
                        const chinese = realName.slice(5);
                        card.innerHTML = `<div style="font-weight: bold; font-size: 1.2em;">${chinese}</div><div style="font-weight: bold; font-size: 1.25em; color: #555;">${clid}</div>`;
                        card.style.display = 'flex';
                        card.style.flexDirection = 'column';
                        card.style.justifyContent = 'center';
                        card.style.alignItems = 'center';
                    }
                }
            });
        }

        evtListenPortal(true);
        const btn = document.getElementById('shuffle-btn');
        btn.addEventListener('click', animateShuffle);
    });

    window.addEventListener('resize', function() {
        evtListenPortal(false);
    });
    </script>
</body>
</html>