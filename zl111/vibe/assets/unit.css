/* Unit layout styles for ViBE regular units */

/* Wider main container for multi-column layout */
main.wide {
  max-width: 1280px;
  padding: 1rem 1.2rem;
  min-height: calc(100vh - 20px);
}

.unit-grid {
  display: grid;
  grid-template-columns: 2fr 3fr 4fr; /* ratio 2:3:4 */
  gap: 12px;
  align-items: stretch; /* make columns equal height */
  height: calc(100vh - 40px); /* fit viewport tightly */
}

.col { display: flex; flex-direction: column; height: 100%; min-height: 0; }

.panel {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 12px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.03);
  min-height: 0; /* allow inner scroll */
  overflow: auto; /* each area scrollable */
}

/* Reduce top padding only for the left narrative panel */
.panel.narrative { padding-top: 8px; } /* the space above the 1st line in left column */

/* Ensure the very first element inside narrative has no top margin */
.narrative > *:first-child { margin-top: 0; }

.narrative h3:first-child,
.narrative p:first-child { margin-top: 4px; }

.split-vertical {
  display: grid;
  grid-template-rows: 1fr 1fr; /* default equal halves */
  gap: 12px;
  height: 100%; /* fill column height */
  min-height: 0; /* prevent overflow from grid children */
}

/* space above the white tile area */
.input-panel .tile-bank { margin-top: 4px; }

/* space above the black canvas */
.input-panel .tile-canvas.dark { margin-top: 4px; }

/* Middle column: AI response large, input minimal */
/* .split-vertical-3-1 { grid-template-rows: 14fr 4fr; }  ≈22% lower */
.split-vertical-3-1 { grid-template-rows: 8.8fr 3fr; row-gap: 6px; }
                                       /* ^ larger, lower black, larger, lower lower edge? */
                                             /* ^ smaller, lower black, larger higher upper edge? */
                                        /* middle bottom black height */ /* bottom margein */
/* Right column: code larger than output (3:2) */
.split-vertical-3-2 { grid-template-rows: 3fr 2fr; }

/* 
In your two-row column, grid-template-rows sets the vertical height ratio between the upper and lower panels.
Examples:
•  grid-template-rows: 3fr 1fr → upper 75%, lower 25%
•  grid-template-rows: 7fr 3fr → upper 70%, lower 30%
•  grid-template-rows: 13fr 4fr → upper ≈76.5%, lower ≈23.5%
General rule: lower% = second / (first + second). Increase the first number to make upper 1/2 of the column taller; increase the second to make lower taller. 

how is the height of the black area determined then?
•  It’s the second value in grid-template-rows relative to the sum of both values: height(lower) = second / (first + second) × height(column).
•  The column height is set by its container: your .split-vertical has height: 100%, and the parent column has a fixed grid height (unit-grid). So the black area = that fraction of the column’s computed height.
•  Any extra constraints (min-height on the black block, panel padding/borders, row gap) slightly affect the perceived space; reduce min-heights and padding if you need finer control.
*/

.section-title { /* AI 回應 */
  margin: 0 0 2px 0;
  color: #4a6cf7;
  font-size: 1.1rem;
}

.hint { color: #6b7280; font-size: 0.95rem; }
.small { font-size: 0.9rem; color: #6b7280; }

.code-editor {
  width: 100%;
  height: 280px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 14px;
  line-height: 1.45;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  padding: 8px;
  box-sizing: border-box;
}

.output {
  background: #ffffff;
  color: #1f2937;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #e5e7eb;
  min-height: 160px;
  white-space: pre-wrap;
  overflow: auto;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  margin-top: 0; /* remove UA top margin on pre */
}
/* Ensure no gap between title and output blocks */
.panel .output { margin-top: 0; padding-bottom: var(--out-pad-bottom, 110px); }

.output.dark {
  background: #0b1021;
  color: #e5e7eb;
  border-color: #1f2937;
}
/* Gray variant for output panels (keeps dark theme semantics, just lighter) */
.output.gray {
  background: lightgray; /* #111827; /* slate-900-like */
  color: black; /* #e5e7eb; */
  border-color: lightgray; /* #1f2937; */
}
/* Ensure code blocks inside dark/gray panels are dark and flush */
.output.dark pre, .output.gray pre { background: transparent !important; border: none; margin: 0; padding-left: 0; padding-right: 0; }
.output.dark code, .output.gray code { background: transparent; }

#aiMd { position: relative; height: calc(100% - var(--ai-bottom-gap, 0px)); display: flex; flex-direction: column; overflow: hidden; padding: 0px 10px 8px 10px !important; }
#aiMdContent { flex: 1 1 auto; overflow: hidden; padding-bottom: 0; margin-top: 0; font-size: clamp(12px, 1.15vw, 15px); line-height: 1.42; text-align: left; }
#aiMdContent > *:first-child { margin-top: 0 !important; }
#aiMdContent h3 { margin: 0 0 2px 0; font-size: 1.05em; }
#aiMdContent p { margin: 0 0 2px 0; }
#aiMdContent ul { margin: 0 0 4px 0; padding-left: 1.1em; }
#aiMdContent li { margin: 0 0 2px 0; }
#aiMdContent pre { font-size: 0.95em; line-height: 1.38; max-height: 45%; overflow: hidden; margin: 4px 0 0 0; }

#applyToCode { position: static; display: inline-flex; align-self: flex-start; margin-top: 4px; margin-left: 0; }
.output code { font-family: inherit; font-size: 14px; line-height: 1.6; text-shadow: none !important; }
.output.dark code, .output.dark .token { text-shadow: none !important; }

/* Title state colors */
/* Dimmed but bluish (brand color with transparency) */
.title-dim { color: rgba(74, 108, 247, 0.55) !important; font-weight: 600 !important; }
.title-hot { color: #ef4444 !important; font-weight: 700 !important; }
.title-norm { color: #4a6cf7 !important; font-weight: 600 !important; }

/* Brief blink when turning red */
@keyframes title-blink { 0%,100% { opacity: 1; } 50% { opacity: 0.45; } }
.title-hot.blink { animation: title-blink var(--blink-duration, 0.6s) ease-in-out var(--blink-times, 4); }

.ai-box {
  background: #f8fafc;
  border: 1px dashed #cbd5e1;
  border-radius: 8px;
  padding: 10px;
  min-height: 140px;
  display: grid; /* title + content grid inside panel */
  grid-template-rows: auto 1fr; /* header, black content fills */
  overflow: hidden; /* prevent panel scroll; content must fit */
}

/* Panel header */
.panel-header { display: flex; align-items: center; gap: 8px; }
.panel-header .title { font-size: 1.05rem; font-weight: 600; color: #4a6cf7; }
.panel-header .actions { margin-left: auto; display: flex; gap: 6px; align-items: center; }
.panel-header .actions button:disabled { opacity: 0.5; cursor: not-allowed; }
.btn-compact { padding: 2px 8px; font-size: 0.82rem; line-height: 1.5; }

/* Phrase builder */
.tile-bank, .tile-canvas {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  padding: 6px 8px;
  border: 1px dashed #e5e7eb;
  border-radius: 6px;
  min-height: 44px;
  background: #fafafa;
  overflow: hidden; /* no scrolling */
}
.tile-canvas { background: #fff; border-style: solid; }
.tile-canvas.dark { background: #0b1021; color: #e5e7eb; border-color: #1f2937; }

/* Make the input panel canvas occupy more space */
/* Lower-middle panel uses grid so spacer reliably reserves bottom space */
.panel.input-panel {
  display: grid;
  grid-template-rows: auto auto 1fr auto; /* header, tile bank, canvas (fills), spacer */
  row-gap: 6px; /* slight space between white and black */
  overflow: hidden; /* prevent inner scroll from affecting layout */
}
.input-panel .panel-header { margin: 0 0 2px 0; padding-top: 0; padding-bottom: 0; }
.input-panel .tile-bank { margin-top: 0; margin-bottom: 0; }
.input-panel .tile-canvas { min-height: 48px; }
.input-panel .tile-canvas.dark { line-height: 1.35; margin-top: -2px;}
.input-panel .lower-spacer { height: 400px; }
.tile {
  display: inline-block;
  padding: 1px 6px;
  background: #eef2ff;
  border: 1px solid #c7d2fe;
  color: #3730a3;
  border-radius: 999px;
  cursor: pointer;
  user-select: none;
  font-size: 0.85rem;
}
.tile.linky {
  background: transparent;
  border: none;
  color: #1f2937;
  padding: 0 4px;
  border-radius: 0;
  text-decoration: underline dotted;
}
.tile.on-canvas { background: transparent; border: none; color: #e5e7eb; text-decoration: underline; }
.tile.used { opacity: 0.5; text-decoration: line-through; cursor: default; }

.split-vertical-3-2 .panel .toolbar { margin-top: 2px; }

#codeDraftWrap { min-height: 240px; overflow: hidden; }
#mockOutput { min-height: 222px; }

.panel.narrative .toolbar .narrativeNext { 
  font-size: 1.1rem; 
  padding: 4px 10px; 
  font-family: inherit;
  font-weight: 700; /* adjust if needed */
  margin-top: -1.5em
}

/* Narrative */
/* Tighter spacing only for the left narrative column */
.panel.narrative h3 { margin-bottom: -2px; } 
.panel.narrative p,
.panel.narrative li { 
  margin-top: .7em; 
  margin-bottom: 0; 
  line-height: 1.7; 
  font-size: 1.17rem;
}
/* .panel.narrative ul { margin: 4px 0 8px 1.1em; } */

.narrative {
  font-size: 1.1rem;
  line-height: 1.7;
}

.user-input {
  width: 100%;
  min-height: 80px; /* keep user input minimal */
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  padding: 8px;
  font-size: 1.1rem;
  box-sizing: border-box;
}

.toolbar { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
.toolbar .status { margin-left: auto; font-size: 0.9rem; color: #6b7280; }
.toolbar button:disabled { opacity: 0.5; cursor: not-allowed; }

.example-list { margin: 0.2rem 0 0.8rem 0; padding-left: 1rem; }
.example-list li { margin: 0.25rem 0; }
.example-btn { margin-left: 6px; padding: 0.15rem 0.5rem; font-size: 0.85rem; }

.badge { display: inline-block; background:#eef2ff; color:#3730a3; border:1px solid #c7d2fe; border-radius:999px; padding:2px 8px; font-size:0.8rem; }
